<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WY MovieBox</title>
<!-- Load Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
  // Tailwind Configuration for Dark Theme and Primary Color
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          // Primary color is a bright cyan/teal (#00bcd4) - á€¡á€•á€¼á€¬á€›á€±á€¬á€„á€º (Cyan)
          primary: '#00bcd4',
          darkbg: '#0a0a0a',
          midbg: '#1a1a1a'
        },
        // Using Inter font stack (default Tailwind font)
        fontFamily: {
          sans: ['Inter', 'sans-serif'],
        }
      }
    }
  }
</script>
<style>
  /* Custom utility to ensure the fullscreen button is on top of controls */
  .z-player-btn {
    z-index: 10;
  }
  
  /* Hides the scrollbar for the Movie List */
  .custom-scrollbar-hide {
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
  }
  .custom-scrollbar-hide::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  /* Simple Animation for Feedback */
  @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
  }
  .shake-error {
      animation: shake 0.3s ease-in-out;
  }
</style>
</head>
<!-- body-root á€á€½á€„á€º theme á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€™á€¾á€¯á€™á€»á€¬á€¸á€¡á€á€½á€€á€º class á€™á€»á€¬á€¸á€€á€­á€¯ á€‘á€­á€”á€ºá€¸á€á€»á€¯á€•á€ºá€‘á€¬á€¸á€žá€Šá€ºá‹ -->
<body class="bg-darkbg text-white min-h-screen pb-24 font-sans transition-colors duration-500" id="body-root">

<div class="max-w-4xl mx-auto px-4">

  <!-- STICKY HEADER AND PLAYER SECTION -->
  <!-- header-sticky á€á€½á€„á€º theme á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€™á€¾á€¯á€™á€»á€¬á€¸á€¡á€á€½á€€á€º class á€™á€»á€¬á€¸á€€á€­á€¯ á€‘á€­á€”á€ºá€¸á€á€»á€¯á€•á€ºá€‘á€¬á€¸á€žá€Šá€ºá‹ -->
  <div id="header-sticky" class="sticky top-0 z-20 bg-darkbg pt-5 shadow-2xl shadow-darkbg/80 transition-colors duration-500">
    
    <!-- App Title (á€¡á€“á€­á€€ á€á€±á€«á€„á€ºá€¸á€…á€‰á€º) -->
    <h1 id="main-title" class="text-2xl pb-3 font-extrabold text-center tracking-wider text-primary">
      WY Movie<span class="text-white" id="title-box">Box</span>
    </h1>

    <!-- Category Menu: data-i18n attribute á€™á€»á€¬á€¸á€–á€¼á€„á€·á€º á€˜á€¬á€žá€¬á€•á€¼á€”á€ºá€›á€”á€º á€™á€¾á€á€ºá€žá€¬á€¸á€‘á€¬á€¸á€žá€Šá€ºá‹ -->
    <div id="menu-bar" class="flex justify-between mx-auto my-2 px-0 sm:px-4">
      <button class="menu-btn transition-all duration-300 bg-gray-800 text-white px-2 py-1.5 rounded-full text-sm font-medium hover:bg-gray-700 active-category" data-category="action" onclick="showCategory('action', this)" data-i18n="action">Action</button>
      <button class="menu-btn transition-all duration-300 bg-gray-800 text-white px-2 py-1.5 rounded-full text-sm font-medium hover:bg-gray-700" data-category="drama" onclick="showCategory('drama', this)" data-i18n="drama">Drama</button>
      <button class="menu-btn transition-all duration-300 bg-gray-800 text-white px-2 py-1.5 rounded-full text-sm font-medium hover:bg-gray-700" data-category="cartoon" onclick="showCategory('cartoon', this)" data-i18n="cartoon">Cartoon</button>
      <button class="menu-btn transition-all duration-300 bg-gray-800 text-white px-2 py-1.5 rounded-full text-sm font-medium hover:bg-gray-700" data-category="romance" onclick="showCategory('romance', this)" data-i18n="romance">Romance</button>
      <button class="menu-btn transition-all duration-300 bg-gray-800 text-white px-2 py-1.5 rounded-full text-sm font-medium hover:bg-gray-700" data-category="myanmar" onclick="showCategory('myanmar', this)" data-i18n="myanmar">Myanmar</button>
    </div>
    
    <!-- Current Movie Title Display -->
    <div class="flex items-center justify-center mb-6 mt-4">
      <p id="current-movie-title" class="text-center text-sm text-gray-400 truncate" data-i18n="selectMovie">Select a movie below.</p>
    </div>

    <!-- Video Player Container (Target for Fullscreen) -->
    <div id="player-container" class="w-full max-w-3xl mx-auto rounded-xl overflow-hidden relative shadow-2xl shadow-primary/30 bg-black mb-6">
      <video id="player" controls poster="https://placehold.co/650x366/1a1a1a/cccccc?text=Select+a+Movie+to+Play" class="w-full h-auto rounded-xl">
        <source id="videoSource" src="" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <!-- Fullscreen Button -->
      <button class="absolute bottom-3 right-4 bg-black/50 text-white rounded-lg p-2 text-xl hover:bg-black/75 transition duration-150 z-player-btn" onclick="toggleFullScreen()" title="Toggle Fullscreen">
        &#x26F6;
      </button>
      <!-- Favorite Button -->
      <button id="favorite-btn" class="absolute top-3 right-4 text-white hover:scale-110 transition duration-150 z-player-btn" onclick="toggleFavorite()" title="Add to Favorites">
        <!-- Default Outline Heart Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
      </button>
    </div>
  </div>
  <!-- END STICKY SECTION -->

  <!-- Movie List Grid / Profile Settings Container -->
  <div id="movies" class="custom-scrollbar-hide flex justify-center flex-wrap gap-3 p-2 pt-4">
    <!-- Content injected here -->
  </div>

</div>

<!-- Bottom Navigation Bar (á€¡á€±á€¬á€€á€ºá€á€¼á€± Navigation Bar) - Fixed á€–á€¼á€…á€ºá€žá€Šá€ºá‹ -->
<!-- nav-bar á€á€½á€„á€º theme á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€™á€¾á€¯á€™á€»á€¬á€¸á€¡á€á€½á€€á€º class á€™á€»á€¬á€¸á€€á€­á€¯ á€‘á€­á€”á€ºá€¸á€á€»á€¯á€•á€ºá€‘á€¬á€¸á€žá€Šá€ºá‹ -->
<div class="fixed bottom-0 left-0 w-full flex justify-around bg-midbg border-t border-gray-700 p-3 shadow-2xl shadow-black/80 transition-colors duration-500" id="nav-bar">
  <!-- Home Button -->
  <button class="nav-btn text-primary font-bold flex flex-col items-center" data-nav="home" onclick="changeNav(this)">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 2 0 1-2 2H5a2 2 2 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    <span class="text-xs mt-1" data-i18n="navHome">Home</span>
  </button>
  <!-- Trending Button -->
  <button class="nav-btn text-gray-400 hover:text-white transition-colors flex flex-col items-center" data-nav="trending" onclick="changeNav(this)">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.8 17.8 21 21"/><path d="M5.88 5.88a10 10 0 1 0 14.2 14.2"/></svg>
    <span class="text-xs mt-1" data-i18n="navTrending">Trending</span>
  </button>
  <!-- Favorites Button -->
  <button class="nav-btn text-gray-400 hover:text-white transition-colors flex flex-col items-center" data-nav="favorites" onclick="changeNav(this)">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
    <span class="text-xs mt-1" data-i18n="navFavorites">Favorites</span>
  </button>
  <!-- Profile Button -->
  <button class="nav-btn text-gray-400 hover:text-white transition-colors flex flex-col items-center" data-nav="profile" onclick="changeNav(this)">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 4 0 0 0-4-4H9a4 4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    <span class="text-xs mt-1" data-i18n="navProfile">Profile</span>
  </button>
</div>

<script>

// -------------------------------------------------------------------------
// 1. DATA AND CONFIGURATION
// -------------------------------------------------------------------------

// Global User Data (Simplified for localStorage)
let userId = localStorage.getItem('localUserId') || crypto.randomUUID();
// Ensure the generated UUID is saved for future sessions
if (localStorage.getItem('localUserId') === null) {
    localStorage.setItem('localUserId', userId);
}

// ðŸŽ¬ Demo movie data 
const videos = {
  action: [
    // Google Drive link
    {title: "The Hard Road (Google Drive)", thumb: "https://placehold.co/110x165/dc2626/ffffff?text=Action+1", src: "https://docs.google.com/uc?export=download&id=1oEPsDmZmHQS_ysrz5jeCDksqcIZTBL5x", id: "action1"},
    {title: "Shadow Strike", thumb: "https://placehold.co/110x165/dc2626/ffffff?text=Action+2", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4", id: "action2"},
    {title: "Sintel", thumb: "https://placehold.co/110x165/dc2626/ffffff?text=Action+3", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4", id: "action3"},
    {title: "Tears of Steel", thumb: "https://placehold.co/110x165/dc2626/ffffff?text=Action+4", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4", id: "action4"},
    {title: "Volkswagen GTI Review", thumb: "https://placehold.co/110x165/dc2626/ffffff?text=Action+5", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/VolkswagenGTIReview.mp4", id: "action5"},
  ],
  drama: [
    {title: "Subaru Outback Test Drive", thumb: "https://placehold.co/110x165/1e40af/ffffff?text=Drama+1", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4", id: "drama1"},
    {title: "For Bigger Blazes", thumb: "https://placehold.co/110x165/1e40af/ffffff?text=Drama+2", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4", id: "drama2"},
    {title: "For Bigger Fun", thumb: "https://placehold.co/110x165/1e40af/ffffff?text=Drama+3", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4", id: "drama3"},
    {title: "For Bigger Joyrides", thumb: "https://placehold.co/110x165/1e40af/ffffff?text=Drama+4", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4", id: "drama4"},
    // Additional items to ensure more than 10 total videos
    {title: "A Quiet Life", thumb: "https://placehold.co/110x165/1e40af/ffffff?text=Drama+5", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4", id: "drama5"},
  ],
  cartoon: [
    {title: "For Bigger Escapes", thumb: "https://placehold.co/110x165/059669/ffffff?text=Cartoon+1", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4", id: "cartoon1"},
    {title: "We Are Going On Bullrun", thumb: "https://placehold.co/110x165/059669/ffffff?text=Cartoon+2", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4", id: "cartoon2"},
    {title: "Tiny Toon Adventures", thumb: "https://placehold.co/110x165/059669/ffffff?text=Cartoon+3", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4", id: "cartoon3"},
  ],
  romance: [
    {title: "Starlight Kiss", thumb: "https://placehold.co/110x165/f97316/ffffff?text=Romance+1", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4", id: "romance1"}, 
    {title: "A Night in June", thumb: "https://placehold.co/110x165/f97316/ffffff?text=Romance+2", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4", id: "romance2"}, 
  ],
  myanmar: [
    {title: "á€á€»á€…á€ºá€™á€¼á€”á€ºá€™á€¬ (Myanmar 1)", thumb: "https://placehold.co/110x165/4f46e5/ffffff?text=á€™á€¼á€”á€ºá€™á€¬+1", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4", id: "myanmar1"}, 
    {title: "á€¡á€±á€¸á€á€»á€™á€ºá€¸á€žá€±á€¬ (Myanmar 2)", thumb: "https://placehold.co/110x165/4f46e5/ffffff?text=á€™á€¼á€”á€ºá€™á€¬+2", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4", id: "myanmar2"}, 
  ]
};

// Default settings
const defaultSettings = {
    language: 'myanmar', // Default to Myanmar
    theme: 'dark', // Default to Dark
    name: '',
    email: ''
};
let currentSettings = {};

// Favorites storage (stores IDs of favorite movies)
let favorites = [];

// Current playing movie state
let currentPlayingMovie = null;


// Translations object for Burmese and English
const translations = {
    myanmar: {
        title: "WY á€›á€¯á€•á€ºá€›á€¾á€„á€ºá€žá€±á€á€¹á€á€¬",
        selectMovie: "á€›á€¯á€•á€ºá€›á€¾á€„á€ºá€€á€­á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«",
        nowPlaying: "á€šá€á€¯á€–á€½á€„á€·á€ºá€”á€±á€žá€Šá€º",
        noFavorites: "á€™á€¾á€á€ºá€žá€¬á€¸á€‘á€¬á€¸á€žá€±á€¬ á€—á€®á€’á€®á€šá€­á€¯á€™á€»á€¬á€¸ á€™á€›á€¾á€­á€žá€±á€¸á€•á€«",
        noContent: "á€¤á€€á€á€¹á€á€á€½á€„á€º á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€¡á€›á€¬á€™á€»á€¬á€¸ á€™á€›á€¾á€­á€žá€±á€¸á€•á€«á‹",
        navHome: "á€™á€°á€œá€…á€¬á€™á€»á€€á€ºá€”á€¾á€¬",
        navTrending: "á€á€±á€á€ºá€…á€¬á€¸á€”á€±á€žá€Šá€º",
        navFavorites: "á€¡á€”á€¾á€…á€ºá€žá€€á€ºá€†á€¯á€¶á€¸",
        navProfile: "á€¡á€žá€¯á€¶á€¸á€•á€¼á€¯á€žá€°",
        settingsTitle: "á€¡á€žá€¯á€¶á€¸á€•á€¼á€¯á€žá€° á€†á€€á€ºá€á€„á€ºá€™á€»á€¬á€¸",
        settingsName: "á€”á€¬á€™á€Šá€º",
        settingsEmail: "á€¡á€®á€¸á€™á€±á€¸á€œá€º",
        settingsTheme: "á€¡á€œá€„á€ºá€¸/á€¡á€™á€¾á€±á€¬á€„á€º (Theme)",
        themeDark: "á€¡á€™á€¾á€±á€¬á€„á€º",
        themeLight: "á€¡á€œá€„á€ºá€¸",
        settingsLanguage: "á€˜á€¬á€žá€¬á€…á€€á€¬á€¸",
        langMyanmar: "á€™á€¼á€”á€ºá€™á€¬",
        langEnglish: "á€¡á€„á€ºá€¹á€‚á€œá€­á€•á€º",
        saveSettings: "á€žá€­á€™á€ºá€¸á€™á€Šá€º",
        favoritesHeader: "á€¡á€”á€¾á€…á€ºá€žá€€á€ºá€†á€¯á€¶á€¸á€™á€»á€¬á€¸",
        trendingHeader: "á€á€±á€á€ºá€…á€¬á€¸á€”á€±á€žá€±á€¬ á€—á€®á€’á€®á€šá€­á€¯ (á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸ áá€ á€•á€¯á€’á€º)", // NEW
        action: "á€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸á€™á€¾á€¯",
        drama: "á€’á€›á€¬á€™á€¬",
        cartoon: "á€€á€¬á€á€½á€”á€ºá€¸",
        romance: "á€¡á€á€»á€…á€º",
        myanmar: "á€™á€¼á€”á€ºá€™á€¬",
        selectCategory: "á€›á€½á€±á€¸á€á€»á€šá€ºá€‘á€¬á€¸á€žá€±á€¬ á€€á€á€¹á€",
        selectMovieForFavorite: "Favorite á€™á€¾á€á€ºá€›á€”á€º á€—á€®á€’á€®á€šá€­á€¯á€á€…á€ºá€á€¯á€€á€­á€¯ á€¡á€›á€„á€ºá€–á€½á€„á€·á€ºá€•á€«",
    },
    english: {
        title: "WY MovieBox",
        selectMovie: "Select a movie below.",
        nowPlaying: "Now Playing",
        noFavorites: "No favorites added yet.",
        noContent: "No content found in this category.",
        navHome: "Home",
        navTrending: "Trending",
        navFavorites: "Favorites",
        navProfile: "Profile",
        settingsTitle: "User Settings",
        settingsName: "Name",
        settingsEmail: "Email",
        settingsTheme: "Theme (Dark/Light)",
        themeDark: "Dark",
        themeLight: "Light",
        settingsLanguage: "Language",
        langMyanmar: "Myanmar",
        langEnglish: "English",
        saveSettings: "Save Settings",
        favoritesHeader: "Favorites",
        trendingHeader: "Trending Videos (Last 10)", // NEW
        action: "Action",
        drama: "Drama",
        cartoon: "Cartoon",
        romance: "Romance",
        myanmar: "Myanmar",
        selectCategory: "Selected Category",
        selectMovieForFavorite: "Please play a movie first to add to favorites.",
    }
};

// -------------------------------------------------------------------------
// 2. LOCAL STORAGE HANDLING
// -------------------------------------------------------------------------

/**
 * Loads current settings and favorites from localStorage.
 */
function loadDataFromLocalStorage() {
    // 1. Load Settings
    const storedSettings = localStorage.getItem('userSettings');
    try {
        if (storedSettings) {
            currentSettings = { ...defaultSettings, ...JSON.parse(storedSettings) };
        } else {
            currentSettings = { ...defaultSettings };
        }
    } catch (e) {
        console.error("Error parsing settings from localStorage, using defaults.", e);
        currentSettings = { ...defaultSettings };
    }
    
    // 2. Load Favorites
    const storedFavorites = localStorage.getItem('favorites');
    try {
        if (storedFavorites) {
            favorites = JSON.parse(storedFavorites);
            if (!Array.isArray(favorites)) favorites = [];
        } else {
            favorites = [];
        }
    } catch (e) {
        console.error("Error parsing favorites from localStorage, resetting.", e);
        favorites = [];
    }
    
    applySettings();
    // Ensure the default view is rendered
    const homeBtn = document.querySelector('.nav-btn[data-nav="home"]');
    if (homeBtn) {
        changeNav(homeBtn);
    }
}

/**
 * Saves current user settings to localStorage.
 */
window.saveSettings = function() {
    const name = document.getElementById('setting-name').value;
    const email = document.getElementById('setting-email').value;
    const theme = document.getElementById('setting-theme').value;
    const language = document.getElementById('setting-language').value;

    const newSettings = { name, email, theme, language };
    
    try {
        localStorage.setItem('userSettings', JSON.stringify(newSettings));
        console.log("Settings saved successfully to localStorage.");
        // Apply settings immediately after saving
        currentSettings = { ...currentSettings, ...newSettings };
        applySettings();
        // Go back to the home view after saving
        changeNav(document.querySelector('.nav-btn[data-nav="home"]'));
    } catch (e) {
        console.error("Error saving settings to localStorage:", e);
    }
}

/**
 * Saves the current favorites array to localStorage.
 */
function saveFavoritesToLocalStorage() {
    try {
        localStorage.setItem('favorites', JSON.stringify(favorites));
        console.log("Favorites updated successfully in localStorage:", favorites);
    } catch (e) {
        console.error("Error saving favorites to localStorage:", e);
    }
}


// -------------------------------------------------------------------------
// 3. UI AND VIEW MANAGEMENT
// -------------------------------------------------------------------------

/**
 * Applies the current settings (theme and language) to the UI.
 */
function applySettings() {
    const { theme, language } = currentSettings;

    // 1. Apply Theme
    const bodyRoot = document.getElementById('body-root');
    const headerSticky = document.getElementById('header-sticky');
    const navBar = document.getElementById('nav-bar');

    if (theme === 'light') {
        bodyRoot.classList.remove('bg-darkbg', 'text-white');
        bodyRoot.classList.add('bg-gray-100', 'text-gray-900');
        
        headerSticky.classList.remove('bg-darkbg', 'shadow-darkbg/80');
        headerSticky.classList.add('bg-white', 'shadow-gray-300/80');

        navBar.classList.remove('bg-midbg', 'border-gray-700', 'shadow-black/80');
        navBar.classList.add('bg-white', 'border-gray-200', 'shadow-gray-400/80');
        
        // Update movie card backgrounds for light mode
        document.querySelectorAll('.movie-card-bg').forEach(el => {
            el.classList.remove('bg-gray-800');
            el.classList.add('bg-white');
        });
    } else { // Dark theme
        bodyRoot.classList.remove('bg-gray-100', 'text-gray-900');
        bodyRoot.classList.add('bg-darkbg', 'text-white');

        headerSticky.classList.remove('bg-white', 'shadow-gray-300/80');
        headerSticky.classList.add('bg-darkbg', 'shadow-darkbg/80');

        navBar.classList.remove('bg-white', 'border-gray-200', 'shadow-gray-400/80');
        navBar.classList.add('bg-midbg', 'border-gray-700', 'shadow-black/80');
        
        // Update movie card backgrounds for dark mode
        document.querySelectorAll('.movie-card-bg').forEach(el => {
            el.classList.remove('bg-white');
            el.classList.add('bg-gray-800');
        });
    }

    // 2. Apply Language
    applyLanguage(language);
    
    // Ensure the default view is rendered with correct theme classes
    if (currentSettings.category) {
        const activeBtn = document.querySelector(`.menu-btn[data-category="${currentSettings.category}"]`);
        if (activeBtn) {
             // Re-render the category to apply theme updates to card elements
             showCategory(currentSettings.category, activeBtn);
        }
    }
}

/**
 * Translates all UI elements marked with data-i18n attribute.
 * @param {string} language - 'myanmar' or 'english'
 */
function applyLanguage(language) {
    const t = translations[language] || translations.english;
    
    // 1. Translate elements with data-i18n
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (t[key]) {
            el.textContent = t[key];
        }
    });

    // 2. Update fixed titles/texts that aren't data-i18n
    document.getElementById('main-title').textContent = t.title;
    
    // 3. Update the category menu buttons text
    document.querySelectorAll('.menu-btn').forEach(btn => {
        const categoryKey = btn.getAttribute('data-category');
        if (t[categoryKey]) {
            btn.textContent = t[categoryKey];
        }
    });

    // 4. Update the current movie title text to use the new language's placeholder
    const currentTitleEl = document.getElementById('current-movie-title');
    if (!currentPlayingMovie) {
        currentTitleEl.textContent = t.selectMovie;
    } else {
        // If a movie is playing, we don't translate the movie title itself,
        // but we ensure the "Now Playing" prefix is in the correct language.
        const originalTitle = currentPlayingMovie.title;
        currentTitleEl.textContent = `${t.nowPlaying}: ${originalTitle}`;
    }
}


/**
 * Changes the main view based on bottom navigation.
 * @param {HTMLElement} btn - The clicked navigation button.
 */
window.changeNav = function(btn) {
    const nav = btn.dataset.nav;
    const navBtns = document.querySelectorAll('.nav-btn');
    const movieContainer = document.getElementById('movies');
    const headerSticky = document.getElementById('header-sticky');

    // Reset all nav buttons
    navBtns.forEach(b => {
        b.classList.remove('text-primary', 'font-bold');
        b.classList.add('text-gray-400', 'hover:text-white');
    });

    // Activate the clicked button
    btn.classList.add('text-primary', 'font-bold');
    btn.classList.remove('text-gray-400', 'hover:text-white');

    // Hide/Show Menu Bar and Player
    const menuBar = document.getElementById('menu-bar');
    const playerContainer = document.getElementById('player-container');
    
    // Clear movie container content
    movieContainer.innerHTML = '';

    // Switch view
    switch (nav) {
        case 'home':
            // Show category menu and player
            menuBar.classList.remove('hidden');
            playerContainer.classList.remove('hidden');
            headerSticky.classList.add('sticky');
            
            // Default to 'action' category if coming from another view
            const activeCategoryBtn = document.querySelector('.menu-btn.active-category') || document.querySelector('.menu-btn[data-category="action"]');
            
            // Set the category based on the nav for organization, but display based on active button
            currentSettings.category = activeCategoryBtn.dataset.category;
            
            showCategory(currentSettings.category, activeCategoryBtn);
            break;

        case 'trending':
            // Hide category menu but keep player for display
            menuBar.classList.add('hidden');
            playerContainer.classList.remove('hidden');
            headerSticky.classList.add('sticky');
            // Display only the last 10 movies from all categories
            displayTrending();
            break;

        case 'favorites':
            // Hide category menu but keep player for display
            menuBar.classList.add('hidden');
            playerContainer.classList.remove('hidden');
            headerSticky.classList.add('sticky');
            displayFavorites();
            break;

        case 'profile':
            // Hide menu bar and player
            menuBar.classList.add('hidden');
            playerContainer.classList.add('hidden');
            headerSticky.classList.remove('sticky'); // Remove sticky to allow scrolling naturally
            displayProfileSettings();
            break;
    }
}

/**
 * Renders the movie list for a specific category.
 * @param {string} category - The category key (e.g., 'action').
 * @param {HTMLElement} clickedButton - The button element that was clicked.
 */
window.showCategory = function(category, clickedButton) {
    const moviesContainer = document.getElementById('movies');
    moviesContainer.innerHTML = ''; // Clear previous content
    
    const t = translations[currentSettings.language || defaultSettings.language];
    currentSettings.category = category; // Update current category

    // Update active category button styles
    document.querySelectorAll('.menu-btn').forEach(btn => {
        btn.classList.remove('active-category', 'bg-primary', 'text-black');
        btn.classList.add('bg-gray-800', 'text-white');
        
        // Handle dark/light mode for inactive buttons
        if (currentSettings.theme === 'light') {
             btn.classList.remove('bg-gray-800', 'text-white');
             btn.classList.add('bg-gray-200', 'text-gray-800');
        }
    });

    if (clickedButton) {
        clickedButton.classList.remove('bg-gray-800', 'text-white', 'bg-gray-200', 'text-gray-800');
        clickedButton.classList.add('active-category', 'bg-primary', 'text-black');
    }

    const categoryVideos = videos[category] || [];

    if (categoryVideos.length === 0) {
        moviesContainer.innerHTML = `<p class="text-gray-500 mt-10 text-center text-lg">${t.noContent}</p>`;
        return;
    }

    // Add category title header
    moviesContainer.innerHTML = `<h2 class="text-xl font-bold text-center w-full mb-4 text-white">${t.selectCategory}: ${t[category]}</h2>`;


    categoryVideos.forEach(movie => {
        const isFav = favorites.includes(movie.id);
        const card = document.createElement('div');
        const bgColorClass = currentSettings.theme === 'light' ? 'bg-white' : 'bg-gray-800';
        
        card.className = `movie-card-bg ${bgColorClass} rounded-xl shadow-lg hover:shadow-primary/50 transition duration-300 transform hover:scale-[1.03] overflow-hidden cursor-pointer w-36 sm:w-40 flex flex-col`;
        card.setAttribute('data-movie-id', movie.id);

        card.innerHTML = `
            <!-- Thumbnail & Badge -->
            <div class="relative w-full h-auto">
                <img src="${movie.thumb}" alt="${movie.title}" onerror="this.onerror=null;this.src='https://placehold.co/110x165/1a1a1a/cccccc?text=Error'" class="w-full h-full object-cover rounded-t-xl" style="height: 165px;">
                ${isFav ? `<div class="absolute top-2 left-2 text-red-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                </div>` : ''}
            </div>
            <!-- Title -->
            <div class="p-3 flex flex-col justify-between flex-grow">
                <p class="text-sm font-medium leading-tight mb-1 truncate">${movie.title}</p>
                <!-- NOTE: The playVideo function is where the currentPlayingMovie state is set. -->
                <button onclick="playVideo(event, '${movie.id}')" class="mt-2 text-xs font-semibold text-primary hover:text-white hover:bg-primary transition duration-200 py-1 px-2 rounded-full border border-primary">
                    ${t.nowPlaying}
                </button>
            </div>
        `;
        moviesContainer.appendChild(card);
    });
}

/**
 * Finds a movie object by its ID.
 * @param {string} id 
 * @returns {object|null}
 */
function findMovieById(id) {
    for (const category in videos) {
        const movie = videos[category].find(m => m.id === id);
        if (movie) return movie;
    }
    return null;
}

/**
 * Plays the selected video.
 * @param {Event} event 
 * @param {string} movieId 
 */
window.playVideo = function(event, movieId) {
    event.stopPropagation(); // Prevent card click event if a play button is present

    const movie = findMovieById(movieId);
    const player = document.getElementById('player');
    const source = document.getElementById('videoSource');
    const titleEl = document.getElementById('current-movie-title');
    const t = translations[currentSettings.language || defaultSettings.language];
    
    if (movie) {
        // --- CRITICAL STEP: SETTING THE CURRENT MOVIE ---
        currentPlayingMovie = movie; 
        
        source.src = movie.src;
        player.load(); // Load the new source
        player.play().catch(error => {
            console.error("Autoplay failed:", error);
            // Handle autoplay restrictions (e.g., show a play icon/message)
        }); 

        // Update the title
        titleEl.textContent = `${t.nowPlaying}: ${movie.title}`;

        // Update favorite button state
        updateFavoriteButtonState(movie.id);
    } else {
        console.error("Movie not found:", movieId);
    }
}

/**
 * Toggles fullscreen mode for the video player container.
 */
window.toggleFullScreen = function() {
    const playerContainer = document.getElementById('player-container');
    const player = document.getElementById('player');
    
    if (!document.fullscreenElement) {
        // Enter fullscreen on the container
        playerContainer.requestFullscreen().then(() => {
            // Apply custom style to make the video fill the screen in fullscreen mode
            player.style.height = '100vh';
            player.style.width = '100vw';
            player.classList.remove('rounded-xl');
            playerContainer.classList.remove('rounded-xl', 'shadow-2xl', 'shadow-primary/30');
        }).catch(err => {
            console.error(`Error attempting to enable full-screen mode: ${err.message}`);
        });
    } else {
        // Exit fullscreen
        document.exitFullscreen().then(() => {
            // Restore original styles
            player.style.height = 'auto';
            player.style.width = '100%';
            player.classList.add('rounded-xl');
            playerContainer.classList.add('rounded-xl', 'shadow-2xl', 'shadow-primary/30');
        });
    }
}


// -------------------------------------------------------------------------
// 4. FAVORITES LOGIC
// -------------------------------------------------------------------------

/**
 * Renders the list of favorite movies.
 */
function displayFavorites() {
    const moviesContainer = document.getElementById('movies');
    moviesContainer.innerHTML = '';
    
    const t = translations[currentSettings.language || defaultSettings.language];

    moviesContainer.innerHTML = `<h2 class="text-xl font-bold text-center w-full mb-4 text-white">${t.favoritesHeader}</h2>`;

    if (favorites.length === 0) {
        moviesContainer.innerHTML += `<p class="text-gray-500 mt-5 text-center text-lg w-full">${t.noFavorites}</p>`;
        return;
    }

    favorites.forEach(movieId => {
        const movie = findMovieById(movieId);
        if (movie) {
            const card = document.createElement('div');
            const bgColorClass = currentSettings.theme === 'light' ? 'bg-white' : 'bg-gray-800';
            
            card.className = `movie-card-bg ${bgColorClass} rounded-xl shadow-lg hover:shadow-primary/50 transition duration-300 transform hover:scale-[1.03] overflow-hidden cursor-pointer w-36 sm:w-40 flex flex-col`;
            
            card.innerHTML = `
                <!-- Thumbnail with filled Heart -->
                <div class="relative w-full h-auto">
                    <img src="${movie.thumb}" alt="${movie.title}" onerror="this.onerror=null;this.src='https://placehold.co/110x165/1a1a1a/cccccc?text=Error'" class="w-full h-full object-cover rounded-t-xl" style="height: 165px;">
                    <div class="absolute top-2 left-2 text-red-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                    </div>
                </div>
                <!-- Title -->
                <div class="p-3 flex flex-col justify-between flex-grow">
                    <p class="text-sm font-medium leading-tight mb-1 truncate">${movie.title}</p>
                    <button onclick="playVideo(event, '${movie.id}')" class="mt-2 text-xs font-semibold text-primary hover:text-white hover:bg-primary transition duration-200 py-1 px-2 rounded-full border border-primary">
                        ${t.nowPlaying}
                    </button>
                </div>
            `;
            moviesContainer.appendChild(card);
        }
    });
}

/**
 * Toggles the favorite status of the currently playing movie.
 */
window.toggleFavorite = function() {
    const favBtn = document.getElementById('favorite-btn');
    const t = translations[currentSettings.language || defaultSettings.language];
    
    // Check if a movie is currently selected and playing
    if (!currentPlayingMovie) {
        console.warn(t.selectMovieForFavorite);
        // Provide visual feedback (shake/color change) when no movie is selected
        favBtn.classList.add('text-yellow-500', 'shake-error');
        setTimeout(() => {
            favBtn.classList.remove('text-yellow-500', 'shake-error');
        }, 500);
        return;
    }

    const movieId = currentPlayingMovie.id;
    const isFavorite = favorites.includes(movieId);
    
    if (!isFavorite) {
        // Add to favorites
        favorites.push(movieId);
    } else {
        // Remove from favorites
        favorites = favorites.filter(id => id !== movieId);
    }

    // Save to localStorage
    saveFavoritesToLocalStorage();

    // Update UI immediately on the player
    updateFavoriteButtonState(movieId, !isFavorite);
    
    // If on the favorites page, refresh the list manually
    const activeNavBtn = document.querySelector('.nav-btn.text-primary');
    if (activeNavBtn && activeNavBtn.dataset.nav === 'favorites') {
        displayFavorites();
    }
}

/**
 * Updates the heart icon on the player based on the movie's favorite status.
 * @param {string} movieId 
 * @param {boolean} [explicitState] - Optional explicit state override.
 */
function updateFavoriteButtonState(movieId, explicitState = null) {
    // If no movie is playing, let the button keep its default state (outline icon from HTML)
    if (!movieId) {
        return;
    }
    
    const isFav = explicitState !== null ? explicitState : favorites.includes(movieId);
    const favBtn = document.getElementById('favorite-btn');

    if (isFav) {
        // Filled Red Heart
        favBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-red-500" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
        `;
    } else {
        // Outline White Heart
        favBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
        `;
    }
}


// -------------------------------------------------------------------------
// 5. TRENDING LOGIC (NEW)
// -------------------------------------------------------------------------

/**
 * Renders the last 10 movies from all categories combined.
 */
function displayTrending() {
    const moviesContainer = document.getElementById('movies');
    moviesContainer.innerHTML = '';
    
    const t = translations[currentSettings.language || defaultSettings.language];
    
    // 1. Aggregate all movies from all categories
    let allMovies = [];
    for (const category in videos) {
        // Concat the arrays
        allMovies = allMovies.concat(videos[category]);
    }

    // 2. Filter for the last 10 items (simulating the latest 10 uploads/trending items)
    // slice(-10) gets the last 10 elements of the combined list.
    const trendingMovies = allMovies.slice(-10); 
    
    // 3. Add header first
    moviesContainer.innerHTML = `<h2 class="text-xl font-bold text-center w-full mb-4 text-white">${t.trendingHeader}</h2>`;
    
    if (trendingMovies.length === 0) {
        moviesContainer.innerHTML += `<p class="text-gray-500 mt-5 text-center text-lg w-full">${t.noContent}</p>`;
        return;
    }
    
    // 4. Render the list
    trendingMovies.forEach(movie => {
        const isFav = favorites.includes(movie.id);
        const card = document.createElement('div');
        const bgColorClass = currentSettings.theme === 'light' ? 'bg-white' : 'bg-gray-800';
        
        card.className = `movie-card-bg ${bgColorClass} rounded-xl shadow-lg hover:shadow-primary/50 transition duration-300 transform hover:scale-[1.03] overflow-hidden cursor-pointer w-36 sm:w-40 flex flex-col`;
        card.setAttribute('data-movie-id', movie.id);

        card.innerHTML = `
            <!-- Thumbnail & Badge -->
            <div class="relative w-full h-auto">
                <img src="${movie.thumb}" alt="${movie.title}" onerror="this.onerror=null;this.src='https://placehold.co/110x165/1a1a1a/cccccc?text=Error'" class="w-full h-full object-cover rounded-t-xl" style="height: 165px;">
                ${isFav ? `<div class="absolute top-2 left-2 text-red-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                </div>` : ''}
            </div>
            <!-- Title -->
            <div class="p-3 flex flex-col justify-between flex-grow">
                <p class="text-sm font-medium leading-tight mb-1 truncate">${movie.title}</p>
                <!-- NOTE: The playVideo function is where the currentPlayingMovie state is set. -->
                <button onclick="playVideo(event, '${movie.id}')" class="mt-2 text-xs font-semibold text-primary hover:text-white hover:bg-primary transition duration-200 py-1 px-2 rounded-full border border-primary">
                    ${t.nowPlaying}
                </button>
            </div>
        `;
        moviesContainer.appendChild(card);
    });
}


// -------------------------------------------------------------------------
// 6. PROFILE/SETTINGS LOGIC (REUSED)
// -------------------------------------------------------------------------

/**
 * Renders the user profile and settings form.
 */
function displayProfileSettings() {
    const moviesContainer = document.getElementById('movies');
    const t = translations[currentSettings.language || defaultSettings.language];
    
    const themeOptions = [
        { value: 'dark', text: t.themeDark },
        { value: 'light', text: t.themeLight }
    ];
    const languageOptions = [
        { value: 'myanmar', text: t.langMyanmar },
        { value: 'english', text: t.langEnglish }
    ];

    const bgColorClass = currentSettings.theme === 'light' ? 'bg-white text-gray-900 border-gray-200' : 'bg-midbg text-white border-gray-700';

    moviesContainer.innerHTML = `
        <div class="w-full max-w-md mx-auto p-6 rounded-xl shadow-2xl border ${bgColorClass}">
            <h2 class="text-2xl font-bold mb-6 text-primary text-center">${t.settingsTitle}</h2>
            
            <form id="settings-form" onsubmit="event.preventDefault(); saveSettings();">
                
                <!-- Name Field -->
                <div class="mb-4">
                    <label for="setting-name" class="block text-sm font-medium mb-1">${t.settingsName}</label>
                    <input type="text" id="setting-name" value="${currentSettings.name}" class="w-full px-4 py-2 rounded-lg ${currentSettings.theme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-gray-700 text-white'} focus:ring-primary focus:border-primary border-none transition duration-150" placeholder="${t.settingsName}">
                </div>

                <!-- Email Field -->
                <div class="mb-6">
                    <label for="setting-email" class="block text-sm font-medium mb-1">${t.settingsEmail}</label>
                    <input type="email" id="setting-email" value="${currentSettings.email}" class="w-full px-4 py-2 rounded-lg ${currentSettings.theme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-gray-700 text-white'} focus:ring-primary focus:border-primary border-none transition duration-150" placeholder="${t.settingsEmail}">
                </div>

                <!-- Theme Selector -->
                <div class="mb-4">
                    <label for="setting-theme" class="block text-sm font-medium mb-1">${t.settingsTheme}</label>
                    <select id="setting-theme" class="w-full px-4 py-2 rounded-lg appearance-none ${currentSettings.theme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-gray-700 text-white'} focus:ring-primary focus:border-primary transition duration-150">
                        ${themeOptions.map(option => `
                            <option value="${option.value}" ${currentSettings.theme === option.value ? 'selected' : ''}>${option.text}</option>
                        `).join('')}
                    </select>
                </div>

                <!-- Language Selector -->
                <div class="mb-6">
                    <label for="setting-language" class="block text-sm font-medium mb-1">${t.settingsLanguage}</label>
                    <select id="setting-language" class="w-full px-4 py-2 rounded-lg appearance-none ${currentSettings.theme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-gray-700 text-white'} focus:ring-primary focus:border-primary transition duration-150">
                        ${languageOptions.map(option => `
                            <option value="${option.value}" ${currentSettings.language === option.value ? 'selected' : ''}>${option.text}</option>
                        `).join('')}
                    </select>
                </div>

                <!-- User ID Display (for debugging/identification) -->
                <div class="mb-6 p-3 text-xs rounded-lg ${currentSettings.theme === 'light' ? 'bg-gray-200 text-gray-700' : 'bg-gray-800 text-gray-400'}">
                    <span class="font-bold">User ID:</span> 
                    <span id="user-id-display">${userId}</span>
                </div>
                
                <!-- Save Button -->
                <button type="submit" class="w-full bg-primary text-black font-bold py-3 rounded-lg hover:bg-opacity-90 transition duration-300 shadow-lg shadow-primary/50">
                    ${t.saveSettings}
                </button>
            </form>
        </div>
    `;
}

// -------------------------------------------------------------------------
// 7. INITIALIZATION
// -------------------------------------------------------------------------

window.onload = function() {
    // Load settings and favorites from localStorage and apply them to the UI
    loadDataFromLocalStorage();
};

</script>
